<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Air Totem</title>
    <link rel="stylesheet" href="./css/login.css">
    <link rel="shortcut icon" href="../assets/icon/IconAirTotem.ico.jpg">
    <script src="../js/sessao.js"></script>

</head>

<body>
    <h2><a href="index.html">Home</a></h2>
    <h1>Air Totem</h1>
    <div id="mensagemAcesso" style="display: none;"></div>
    <div class="success" style="display: none;">
        <div class="success__icon">
          <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="m12 1c-6.075 0-11 4.925-11 11s4.925 11 11 11 11-4.925 11-11-4.925-11-11-11zm4.768 9.14c.0878-.1004.1546-.21726.1966-.34383.0419-.12657.0581-.26026.0477-.39319-.0105-.13293-.0475-.26242-.1087-.38085-.0613-.11844-.1456-.22342-.2481-.30879-.1024-.08536-.2209-.14938-.3484-.18828s-.2616-.0519-.3942-.03823c-.1327.01366-.2612.05372-.3782.1178-.1169.06409-.2198.15091-.3027.25537l-4.3 5.159-2.225-2.226c-.1886-.1822-.4412-.283-.7034-.2807s-.51301.1075-.69842.2929-.29058.4362-.29285.6984c-.00228.2622.09851.5148.28067.7034l3 3c.0983.0982.2159.1748.3454.2251.1295.0502.2681.0729.4069.0665.1387-.0063.2747-.0414.3991-.1032.1244-.0617.2347-.1487.3236-.2554z" fill="#393a37" fill-rule="evenodd"></path></svg>
        </div>
        <div class="success__title" id="success__title"></div>
        <div class="success__close"><svg height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="m15.8333 5.34166-1.175-1.175-4.6583 4.65834-4.65833-4.65834-1.175 1.175 4.65833 4.65834-4.65833 4.6583 1.175 1.175 4.65833-4.6583 4.6583 4.6583 1.175-1.175-4.6583-4.6583z" fill="#393a37"></path></svg></div>
    </div>
    <div class="error" style="display: none;">
        <div class="error__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24" height="24" fill="none"><path fill="#393a37" d="m13 13h-2v-6h2zm0 4h-2v-2h2zm-1-15c-1.3132 0-2.61358.25866-3.82683.7612-1.21326.50255-2.31565 1.23915-3.24424 2.16773-1.87536 1.87537-2.92893 4.41891-2.92893 7.07107 0 2.6522 1.05357 5.1957 2.92893 7.0711.92859.9286 2.03098 1.6651 3.24424 2.1677 1.21325.5025 2.51363.7612 3.82683.7612 2.6522 0 5.1957-1.0536 7.0711-2.9289 1.8753-1.8754 2.9289-4.4189 2.9289-7.0711 0-1.3132-.2587-2.61358-.7612-3.82683-.5026-1.21326-1.2391-2.31565-2.1677-3.24424-.9286-.92858-2.031-1.66518-3.2443-2.16773-1.2132-.50254-2.5136-.7612-3.8268-.7612z"></path></svg>
        </div>
        <div class="error__title" id="error__title"></div>
        <div class="error__close"><svg xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" height="20"><path fill="#393a37" d="m15.8333 5.34166-1.175-1.175-4.6583 4.65834-4.65833-4.65834-1.175 1.175 4.65833 4.65834-4.65833 4.6583 1.175 1.175 4.65833-4.6583 4.6583 4.6583 1.175-1.175-4.6583-4.6583z"></path></svg></div>
    </div>
    <form>
        <h2>Login</h2>
        <div class="row">
            <label for="email" >Email</label>
            <input type="email" id="ipt_email" name="email" autocomplete="off" placeholder="email@example.com">
        </div>
        <div class="row">
            <label for="password">Senha</label>
            <input type="password" id="ipt_password" name="password">
        </div>
        <button type="button" onclick="entrar()" id="btnLogar">Entrar</button>
        
        <div id="div_aguardar" class="loading-div">
            <img src="./assets/ajax-loader.gif" id="loading-gif">
        </div>
    </form>

</body>

</html>

<script>

function entrar() {
    aguardar();

    var emailVar = ipt_email.value;
    var senhaVar = ipt_password.value;

    console.log("FORM LOGIN: ", emailVar);
    console.log("FORM SENHA: ", senhaVar);

    fetch("/usuarios/autenticar", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            emailServer: emailVar,
            senhaServer: senhaVar
        })
    }).then(function (resposta) {
        console.log("ESTOU NO THEN DO entrar()!");

        if (resposta.ok) {
            console.log(resposta);


            resposta.json().then(json => {
                console.log(json);
                console.log(JSON.stringify(json));
                sessionStorage.ID_USUARIO = json.idUser;
                sessionStorage.NOME_USUARIO = json.nomeUsuario;
                sessionStorage.NOME_EMPRESA = json.nomeEmpresa;
                sessionStorage.EMAIL_USUARIO = json.email;
                sessionStorage.ID_EMPRESA = json.empresaId;
                sessionStorage.NIVEL_ACESSO = json.nivelAcesso;
                sessionStorage.AEROPORTO_ID = json.aeroId; // Armazenando o id do aeroporto

                // Exibir mensagem de acesso
              
                acessoLiberado();

                setTimeout(function () {
                    if(json.nivelAcesso === 'Suporte'){
                        window.location = "./dashboard/geralSuporte.html";
                    } else if(json.nivelAcesso === 'Gerente'){
                        window.location = "./dashboard/dashGerente.html";
                    } else {
                        window.location = "./dashboard/adm.html";
                    }
                }, 2000);

            });

        } else {
            console.log("Houve um erro ao tentar realizar o login!");
            acessoNegado();
            resposta.text().then(texto => {
                console.error(texto);
            });
        }

    }).catch(function (erro) {
        console.log(erro);
    });

    return false;
}

function acessoLiberado() {
    // Selecionar o elemento da mensagem
    debugger
    var bloco = document.querySelector(".success");

    var mensagem = document.getElementById('success__title');
    var loading = document.getElementById('div_aguardar');
    var mensagemElement = document.getElementById('mensagemAcesso');


    bloco.style.display = "block";
    mensagem.style.fontSize = "20px";
    mensagem.style.textAlign = "center";
    mensagem.innerHTML = "Login realizado com sucesso...!"  

    mensagemElement.innerText = 'Acesso realizado com sucesso!';

    setTimeout(function () {
        bloco.style.display="none";
        loading.style.display="none";
                }, 2000);

}

function acessoNegado(){

    var bloco = document.querySelector(".error")
    var mensagem = document.getElementById("error__title");
    var loading = document.getElementById('div_aguardar');

    bloco.style.display = "block";
    mensagem.style.fontSize = "20px";
    mensagem.style.textAlign = "center";
    mensagem.innerHTML = "Dados incorretos! Revise os dados inseridos";

    setTimeout(function (){
        bloco.style.display="none";
        loading.style.display="none";
    }, 2000)
   
}



</script>